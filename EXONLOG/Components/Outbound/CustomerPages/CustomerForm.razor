@page "/customer/form/{CustomerId:int?}"
@using EXONLOG.Data
@using EXONLOG.Model.Outbound
@using EXONLOG.Model.Shared
@inject EXONContext DbContext
@inject NavigationManager Navigation

<h3>@(CustomerId == null ? "Create Customer" : "Edit Customer")</h3>

<EditForm Model="Customer" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div>
        <label>Name:</label>
        <InputText @bind-Value="Customer.Name" class="form-control" />
    </div>
    <div>
        <label>Mobile:</label>
        <InputText @bind-Value="Customer.ContactNumber" class="form-control" />
    </div>
    <div>
        <label>Address:</label>
        <InputTextArea @bind-Value="Customer.Address" class="form-control" />
    </div>
    <div>
        <button type="submit" class="btn btn-primary">Save</button>
    </div>
</EditForm>

@code {
    [Parameter] public int? CustomerId { get; set; }
    private Customer Customer { get; set; } = new Customer();

    protected override async Task OnInitializedAsync()
    {
        if (CustomerId.HasValue)
        {
            Customer = await DbContext.Customers.FindAsync(CustomerId.Value);
            if (Customer == null)
            {
                Navigation.NavigateTo("/customers");
            }
        }
    }

    private async Task HandleValidSubmit()
    {
        if (CustomerId == null)
        {
            DbContext.Customers.Add(Customer);
        }
        else
        {
            DbContext.Customers.Update(Customer);
        }

        await DbContext.SaveChangesAsync();
        Navigation.NavigateTo("/customers");
    }
}
